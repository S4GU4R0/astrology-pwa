<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="/favicon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/pwa-192x192.png">
    <link rel="mask-icon" href="/favicon.svg" color="#FFFFFF">
    <meta name="msapplication-TileColor" content="#FFFFFF">
    <meta name="theme-color" content="#ffffff">

    <meta name="title" content="PWA App">
    <meta name="description" content="Example PWA App">
    <meta name="keywords" content="pwa, vite, tailwindcss, example">
    <meta name="robots" content="index, follow">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="language" content="English">
    <meta name="author" content="zypher">
    <meta name="contact" content="zypher@example.com">
    <meta name="revisit-after" content="1">

    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@example" />
    <meta name="twitter:creator" content="@example" />
    <meta property="og:url" content="https://example.com/pwa" />
    <meta property="og:title" content="PWA App" />
    <meta property="og:description" content="Example PWA App" />
    <meta property="og:image" content="/pwa-512x512.png" />

    <meta name="robots" content="index,follow" />
    <title>Vite App</title>
    <link href="/css/style.css" rel="preload" as="style" onload="this.rel='stylesheet'">
    <noscript>
        <link rel="stylesheet" href="/css/style.css">
    </noscript>

    <!-- old tags from original project -->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css?family=Inter:400,500,600,700,800,900|Space+Grotesk:400,500,600,700,800,900&amp;subset=latin">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@400;600;700;900&display=swap">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/theme.css">
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.3/dist/cdn.min.js" defer></script>
</head>

<body class="antialiased bg-body text-body font-body">
    <div id="app-container">
        <!-- Templates render here -->
    </div>

    <!-- Core Scripts -->
    <script type="text/javascript" src="/src/assets/js/global-14392.js"></script>
    <script src="/src/assets/js/error-handling.js"></script>
    <script src="/src/assets/js/ui-helpers.js"></script>
    <script src="/src/assets/js/astronomy.browser.min.js"></script>

    <!-- Chart Data Management -->
    <script>
        const ChartData = {
            STORAGE_KEY: 'astrodex_chart_data',

            save(data) {
                try {
                    localStorage.setItem(this.STORAGE_KEY, JSON.stringify(data));
                } catch (error) {
                    console.error('Error saving chart data:', error);
                }
            },

            load() {
                try {
                    const data = localStorage.getItem(this.STORAGE_KEY);
                    return data ? JSON.parse(data) : null;
                } catch (error) {
                    console.error('Error loading chart data:', error);
                    return null;
                }
            },

            getCurrentData() {
                return {
                    name: document.getElementById('chartName')?.value || '',
                    date: document.getElementById('chartDate')?.value || '',
                    time: document.getElementById('chartTime')?.value || '',
                    location: document.getElementById('chartLocation')?.value || ''
                };
            },

            setFormData(data) {
                if (document.getElementById('chartName')) document.getElementById('chartName').value = data.name || '';
                if (document.getElementById('chartDate')) document.getElementById('chartDate').value = data.date || '';
                if (document.getElementById('chartTime')) document.getElementById('chartTime').value = data.time || '';
                if (document.getElementById('chartLocation')) document.getElementById('chartLocation').value = data.location || '';
            }
        };

        window.ChartData = ChartData;
    </script>

    <!-- Template System -->
    <script src="/src/assets/js/templates/template-renderer.js"></script>
    <script src="/src/assets/js/templates/sections/header-template.js"></script>
    <script src="/src/assets/js/templates/sections/sidebar-template.js"></script>
    <script src="/src/assets/js/templates/sections/main-template.js"></script>
    <script src="/src/assets/js/templates/sections/properties-template.js"></script>
    <script src="/src/assets/js/templates/sections/footer-template.js"></script>

    <!-- View Components -->
    <script src="/src/assets/js/components/planetary-conditions-view.js"></script>
    <script src="/src/assets/js/components/test-suite-view.js"></script>

    <!-- View Manager -->
    <script>
        const ViewManager = {
            currentView: 'chart',

            loadView(viewName) {
                const mainContent = document.getElementById('mainContentArea');
                if (!mainContent) return;

                mainContent.style.alignItems = 'flex-start';
                mainContent.style.justifyContent = 'flex-start';

                switch (viewName) {
                    case 'chart':
                        mainContent.innerHTML = `
                        <div id="chartView" class="chart-container relative w-full max-w-2xl aspect-square mx-auto" style="margin-top: 2rem;">
                            <svg viewbox="0 0 400 400" class="w-full h-full">
                                <circle cx="200" cy="200" r="190" fill="none" stroke="#4B5563" stroke-width="1"></circle>
                                <circle cx="200" cy="200" r="160" fill="none" stroke="#4B5563" stroke-width="1"></circle>
                                <circle cx="200" cy="200" r="120" fill="none" stroke="#374151" stroke-width="1"></circle>
                                <circle cx="200" cy="200" r="60" fill="none" stroke="#374151" stroke-width="1"></circle>
                                <line x1="200" y1="10" x2="200" y2="40" stroke="#6B7280" stroke-width="2"></line>
                                <line x1="200" y1="360" x2="200" y2="390" stroke="#6B7280" stroke-width="2"></line>
                                <line x1="10" y1="200" x2="40" y2="200" stroke="#6B7280" stroke-width="2"></line>
                                <line x1="360" y1="200" x2="390" y2="200" stroke="#6B7280" stroke-width="2"></line>
                                <text x="200" y="25" text-anchor="middle" fill="#9CA3AF" font-size="10">MC</text>
                                <text x="200" y="385" text-anchor="middle" fill="#9CA3AF" font-size="10">IC</text>
                                <text x="20" y="204" text-anchor="middle" fill="#9CA3AF" font-size="10">ASC</text>
                                <text x="380" y="204" text-anchor="middle" fill="#9CA3AF" font-size="10">DSC</text>
                            </svg>
                        </div>`;
                        mainContent.style.alignItems = 'center';
                        mainContent.style.justifyContent = 'center';
                        break;

                    case 'planetary_conditions':
                        mainContent.innerHTML = '<planetary-conditions-view></planetary-conditions-view>';
                        break;

                    case 'natal_report':
                        mainContent.innerHTML = '<natal-report-view></natal-report-view>';
                        break;

                    case 'test':
                        mainContent.innerHTML = '<test-suite-view></test-suite-view>';
                        break;

                    default:
                        console.warn('Unknown view:', viewName);
                }

                this.currentView = viewName;
            }
        };

        window.ViewManager = ViewManager;

        document.addEventListener('view-change', (e) => {
            if (e.detail && e.detail.view) {
                ViewManager.loadView(e.detail.view);
            }
        });
    </script>

    <!-- Initialize App -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Render templates
            const renderer = new TemplateRenderer();
            renderer.init('app-container');
            renderer.render({
                header: window.HeaderTemplate.createHeaderTemplate,
                sidebar: window.SidebarTemplate.createSidebarTemplate,
                main: window.MainTemplate.createMainTemplate,
                properties: window.PropertiesTemplate.createPropertiesTemplate,
                footer: window.FooterTemplate.createFooterTemplate
            });

            // Load saved chart data
            const savedData = ChartData.load();
            if (savedData) {
                ChartData.setFormData(savedData);
                renderer.updateStatusBar(savedData);
            }

            // Setup form field change listeners
            ['chartName', 'chartDate', 'chartTime', 'chartLocation'].forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', function () {
                        const data = ChartData.getCurrentData();
                        ChartData.save(data);
                        renderer.updateStatusBar(data);
                    });
                }
            });

            // Setup Calculate Chart button
            const calcBtn = document.getElementById('calculateChartBtn');
            if (calcBtn) {
                calcBtn.addEventListener('click', function () {
                    const chartData = ChartData.getCurrentData();
                    ChartData.save(chartData);

                    const originalText = calcBtn.textContent;
                    calcBtn.textContent = 'Calculating...';
                    calcBtn.disabled = true;

                    console.log('Calculate chart for:', chartData);

                    setTimeout(() => {
                        calcBtn.textContent = originalText;
                        calcBtn.disabled = false;
                        if (typeof showToast === 'function') {
                            showToast('Chart calculated successfully!', 'success');
                        }
                    }, 1000);
                });
            }
        });
    </script>
    <script type="module" src="/src/main.js"></script>
</body>

</html>